<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
</head>
<body>
<textarea id="tagPath">[default]BenTest/now</textarea>
<button id="doSubscribe">Subscribe</button>
<textarea id="values"></textarea>
<script>
	
let eventSource = null;

function subscribe() {
	if (eventSource) {
		eventSource.close();
	}

	const tagPath = document.getElementById("tagPath").value;
	const requestBody = JSON.stringify({
		"tags": [tagPath.toString()]
	})
	console.log(requestBody)

	fetch("http://localhost:8088/main/system/subscribe", {
		method: "POST",
		mode: "cors",
		body: requestBody
	}).then(response => response.json())
	.then(json => {
		console.log(json)
		const url = json.url
		eventSource = new EventSource(url);
		eventSource.onmessage = (e) => {
			const content = document.createElement('div');
			content.textContent = e.data;
			document.body.append(content);
		}
		eventSource.addEventListener(tagPath, (e) => {
			var s = document.getElementById("values");
			s.value = e.data;
		})
		eventSource.onopen = function (e) {
			console.log('Opened');
		}
	
		eventSource.onerror = function (e) {
			console.log('Error');
		}
	})
}

document.getElementById("doSubscribe").addEventListener("click", subscribe);

</script>
</body>
</html>